import os
import asyncio
from dotenv import load_dotenv
from langchain_openai import ChatOpenAI

load_dotenv()
model = ChatOpenAI(
    model='deepseek-chat',
    max_tokens=1024,
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url=os.getenv("DEEPSEEK_BASE_URL")
)

# ÂºÇÊ≠•ÊµÅÂ§ÑÁêÜ
async def async_stream():
    events = []
    async for event in model.astream_events("hello", version="v2"):
        events.append(event)
    print(events)

# ËøêË°åÂºÇÊ≠•ÊµÅÂ§ÑÁêÜ
asyncio.run(async_stream())
# ËæìÂá∫
'''
[{'event': 'on_chat_model_start', 'data': {'input': 'hello'}, 'name': 'ChatOpenAI', 'tags': [], 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content='', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content='Hello', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content='!', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' üòä', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' How', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' can', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' I', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' assist', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' you', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content=' today', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content='?', additional_kwargs={}, response_metadata={}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'data': {'chunk': AIMessageChunk(content='', additional_kwargs={}, response_metadata={'finish_reason': 'stop', 'model_name': 'deepseek-chat', 'system_fingerprint': 'fp_3d5141a69a_prod0225'}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661', usage_metadata={'input_tokens': 4, 'output_tokens': 11, 'total_tokens': 15, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})}, 'parent_ids': []}, {'event': 'on_chat_model_end', 'data': {'output': AIMessageChunk(content='Hello! üòä How can I assist you today?', additional_kwargs={}, response_metadata={'finish_reason': 'stop', 'model_name': 'deepseek-chat', 'system_fingerprint': 'fp_3d5141a69a_prod0225'}, id='run-d106e0f1-7079-4e3f-a65a-822856c9a661', usage_metadata={'input_tokens': 4, 'output_tokens': 11, 'total_tokens': 15, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}})}, 'run_id': 'd106e0f1-7079-4e3f-a65a-822856c9a661', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'deepseek-chat', 'ls_model_type': 'chat', 'ls_temperature': None, 'ls_max_tokens': 1024}, 'parent_ids': []}]
'''

